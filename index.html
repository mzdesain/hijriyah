<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Islamic Hub | Muzanni</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Noto+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #ffffff; color: #1e293b; }
        .arabic-num { font-family: 'Noto Sans Arabic', serif; }
        .calendar-grid {
            display: grid; grid-template-columns: repeat(7, 1fr);
            gap: 1px; background-color: #f1f5f9;
            border-radius: 20px; overflow: hidden; border: 1px solid #f1f5f9;
        }
        .calendar-day {
            background-color: #ffffff; aspect-ratio: 1/1.3;
            padding: 6px; display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative; transition: all 0.3s ease;
        }
        
        /* Highlight Latar Belakang Tabel */
        .bg-ayyamul-bidh { background-color: #ecfdf5 !important; } /* Hijau Muda */
        .bg-senin-kamis { background-color: #fff7ed !important; }  /* Orange Muda */
        .bg-hari-raya { background-color: #eff6ff !important; }    /* Biru Muda */
        .bg-arafah { background-color: #f5f3ff !important; }       /* Ungu Muda */

        /* Warna Angka Hijriyah agar tetap kontras */
        .text-ayyamul-bidh { color: #059669; font-weight: 700; }
        .text-senin-kamis { color: #ea580c; font-weight: 700; }
        .text-hari-raya { color: #2563eb; font-weight: 700; }
        .text-arafah { color: #7c3aed; font-weight: 700; }

        .today { border: 2px solid #0f172a; border-radius: 12px; z-index: 10; }
        .day-name { text-align: center; font-size: 0.65rem; font-weight: 800; color: #cbd5e1; padding: 12px 0; text-transform: uppercase; letter-spacing: 0.1em; }
    </style>
</head>
<body class="antialiased pb-10">

    <div class="max-w-xl mx-auto px-6 py-8">
        <header class="mb-10 text-center">
            <div class="inline-flex items-center gap-2 px-3 py-1 bg-emerald-50 text-emerald-600 text-[10px] font-black rounded-full uppercase tracking-widest mb-4">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                <span id="subdistrict-name">Mencari Lokasi...</span>
            </div>
            <h1 id="top-hijri" class="text-4xl font-extrabold text-slate-900 tracking-tighter mb-1 arabic-num">---</h1>
            <p id="top-masehi" class="text-[10px] font-bold text-slate-400 tracking-[0.2em] uppercase"></p>
        </header>

        <section class="grid grid-cols-5 gap-2 mb-10">
            <div class="bg-slate-50 p-3 rounded-2xl text-center border border-slate-100 text-emerald-700">
                <p class="text-[8px] font-black text-slate-300 uppercase mb-1">Subuh</p>
                <p id="fajr" class="text-xs font-bold italic">--:--</p>
            </div>
            <div class="bg-slate-50 p-3 rounded-2xl text-center border border-slate-100 text-emerald-700">
                <p class="text-[8px] font-black text-slate-300 uppercase mb-1">Dzuhur</p>
                <p id="dhuhr" class="text-xs font-bold italic">--:--</p>
            </div>
            <div class="bg-slate-50 p-3 rounded-2xl text-center border border-slate-100 text-emerald-700">
                <p class="text-[8px] font-black text-slate-300 uppercase mb-1">Ashar</p>
                <p id="asr" class="text-xs font-bold italic">--:--</p>
            </div>
            <div class="bg-slate-50 p-3 rounded-2xl text-center border border-slate-100 text-emerald-700">
                <p class="text-[8px] font-black text-slate-300 uppercase mb-1">Maghrib</p>
                <p id="maghrib" class="text-xs font-bold italic">--:--</p>
            </div>
            <div class="bg-slate-50 p-3 rounded-2xl text-center border border-slate-100 text-emerald-700">
                <p class="text-[8px] font-black text-slate-300 uppercase mb-1">Isya</p>
                <p id="isha" class="text-xs font-bold italic">--:--</p>
            </div>
        </section>

        <section>
            <div class="mb-4 px-2">
                <div class="flex items-center justify-between">
                    <h3 id="calendar-label" class="font-extrabold text-xs sm:text-base text-slate-800 tracking-tight">---</h3>
                    <div class="flex gap-1">
                        <button onclick="changeMonth(-1)" class="p-2 hover:bg-slate-100 rounded-full transition-colors text-slate-400">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7"/></svg>
                        </button>
                        <button onclick="changeMonth(1)" class="p-2 hover:bg-slate-100 rounded-full transition-colors text-slate-400">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"/></svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-7 mb-1 text-center font-bold text-slate-300 text-[10px] uppercase tracking-widest">
                <div>Min</div><div>Sen</div><div>Sel</div><div>Rab</div><div>Kam</div><div>Jum</div><div>Sab</div>
            </div>
            <div id="calendar-body" class="calendar-grid"></div>

            <div class="mt-8 grid grid-cols-2 gap-3 px-2">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-emerald-400"></div>
                    <span class="text-[9px] font-bold text-slate-500 uppercase tracking-wider">Ayyamul Bidh</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-orange-400"></div>
                    <span class="text-[9px] font-bold text-slate-500 uppercase tracking-wider">Senin & Kamis</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-blue-400"></div>
                    <span class="text-[9px] font-bold text-slate-500 uppercase tracking-wider">Idul Fitri / Adha</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-purple-400"></div>
                    <span class="text-[9px] font-bold text-slate-500 uppercase tracking-wider">Puasa Arafah</span>
                </div>
            </div>
        </section>

        <footer class="mt-16 text-center border-t border-slate-50 pt-8">
            <p class="text-[9px] font-black text-slate-300 uppercase tracking-[0.3em]">
                &copy; <span id="year"></span> • BY MUZANNI
            </p>
        </footer>
    </div>

    <script>
        let viewDate = new Date();
        const arabicDigits = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
        const toAr = (n) => n.toString().split('').map(d => arabicDigits[d] || d).join('');

        async function init() {
            document.getElementById('year').innerText = new Date().getFullYear();
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => {
                    const { latitude: lat, longitude: lng } = p.coords;
                    updateLocationName(lat, lng);
                    loadData(lat, lng);
                }, () => loadData(-6.2088, 106.8456), { enableHighAccuracy: true });
            } else { loadData(-6.2088, 106.8456); }
        }

        async function updateLocationName(lat, lng) {
            try {
                const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=12`);
                const data = await res.json();
                const kecamatan = data.address.suburb || data.address.village || data.address.district || "Indonesia";
                document.getElementById('subdistrict-name').innerText = kecamatan;
            } catch (e) { document.getElementById('subdistrict-name').innerText = "Indonesia"; }
        }

        async function loadData(lat, lng) {
            try {
                const month = viewDate.getMonth() + 1;
                const year = viewDate.getFullYear();
                
                const calRes = await fetch(`https://api.aladhan.com/v1/calendar?latitude=${lat}&longitude=${lng}&method=11&month=${month}&year=${year}`);
                const calJson = await calRes.json();
                const calendarData = calJson.data;

                const todayRes = await fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lng}&method=11`);
                const todayJson = await todayRes.json();
                const tData = todayJson.data;
                const h = tData.date.hijri;
                document.getElementById('top-hijri').innerText = `${toAr(h.day)} ${h.month.en} ${toAr(h.year)}`;
                document.getElementById('top-masehi').innerText = tData.date.readable.toUpperCase();

                const tim = tData.timings;
                ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'].forEach(k => {
                    document.getElementById(k).innerText = tim[k.charAt(0).toUpperCase() + k.slice(1)];
                });

                updateCalendarLabel(calendarData);
                renderCalendar(viewDate, calendarData);
            } catch (e) { console.error(e); }
        }

        function updateCalendarLabel(calendarData) {
            const masehiMonth = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"][viewDate.getMonth()];
            const startHijri = calendarData[0].date.hijri.month.en;
            const endHijri = calendarData[calendarData.length - 1].date.hijri.month.en;
            const hijriYear = calendarData[Math.floor(calendarData.length/2)].date.hijri.year;
            let hijriLabel = startHijri === endHijri ? startHijri : `${startHijri} - ${endHijri}`;
            document.getElementById('calendar-label').innerHTML = `${masehiMonth} ${viewDate.getFullYear()} <span class="text-slate-200 mx-2">|</span> <span class="text-emerald-600">${hijriLabel} ${hijriYear} H</span>`;
        }

        function renderCalendar(date, calendarData) {
            const body = document.getElementById('calendar-body');
            const firstDayIdx = new Date(date.getFullYear(), date.getMonth(), 1).getDay();
            const today = new Date();

            body.innerHTML = '';
            for (let i = 0; i < firstDayIdx; i++) body.innerHTML += `<div class="calendar-day bg-slate-50/50"></div>`;

            calendarData.forEach((dayData, index) => {
                const d = index + 1;
                const hDay = parseInt(dayData.date.hijri.day);
                const hMonth = parseInt(dayData.date.hijri.month.number);
                const dayOfWeek = parseInt(dayData.date.gregorian.weekday.number); 
                
                let dayBgClass = "";
                let hijriColorClass = "text-slate-400";

                // 1. Ayyamul Bidh - Background Hijau
                if ([13, 14, 15].includes(hDay)) {
                    dayBgClass = "bg-ayyamul-bidh";
                    hijriColorClass = "text-ayyamul-bidh";
                }
                // 2. Senin & Kamis - Background Orange
                else if (dayOfWeek === 1 || dayOfWeek === 4) {
                    dayBgClass = "bg-senin-kamis";
                    hijriColorClass = "text-senin-kamis";
                }
                // 3. Hari Raya - Background Biru
                if ((hMonth === 10 && hDay === 1) || (hMonth === 12 && hDay === 10)) {
                    dayBgClass = "bg-hari-raya";
                    hijriColorClass = "text-hari-raya";
                }
                // 4. Puasa Arafah - Background Ungu
                if (hMonth === 12 && hDay === 9) {
                    dayBgClass = "bg-arafah";
                    hijriColorClass = "text-arafah";
                }

                const isToday = (d === today.getDate() && date.getMonth() === today.getMonth() && date.getFullYear() === today.getFullYear()) ? 'today' : '';
                
                body.innerHTML += `
                    <div class="calendar-day ${isToday} ${dayBgClass}">
                        <span class="masehi-num text-xs font-semibold mb-1">${d}</span>
                        <span class="text-[10px] arabic-num ${hijriColorClass}">${toAr(hDay)}</span>
                    </div>
                `;
            });
        }

        function changeMonth(step) {
            viewDate.setMonth(viewDate.getMonth() + step);
            init(); 
        }

        init();
    </script>
</body>
</html>
